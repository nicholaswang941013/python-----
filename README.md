# 需求管理系統

這是一個使用 Python/Tkinter 開發的需求管理系統，允許管理員創建和分派需求單給員工，員工可以查看和回應他們收到的需求單。

## 主要功能

1. **管理員功能**:
   - 發派需求單給特定員工
   - 預約發派需求單
   - 查看所有已發派的需求單
   - 審核員工提交的需求單
   - 管理刪除的需求單

2. **員工功能**:
   - 查看收到的需求單
   - 提交完成的需求單
   - 查看需求單的詳細信息

## 安裝和運行

```bash
# 安裝依賴
pip install tkinter

# 運行程序
python main.py
```

## 預設用戶
- 管理員: username=`nicholas`, password=`nicholas941013`
- 員工1: username=`user1`, password=`user123`
- 員工2: username=`staff1`, password=`staff123`
- 員工3: username=`staff2`, password=`staff123`

## 最近修復的問題

### 1. 無法刪除需求單問題
- 問題: 錯誤信息 "TypeError: 'User' object is not subscriptable"
- 原因: 在 `requirement_manager.py` 中錯誤地使用 `self.current_user[0]` 而不是 `self.current_user.id`
- 解決方案: 添加 `self.user_id` 屬性，並正確處理不同格式的用戶對象

### 2. 無法發派需求單給新註冊員工問題
- 問題: 員工下拉選單在界面初始化時只加載一次，沒有刷新機制
- 解決方案: 添加刷新按鈕和 `refresh_staff_list` 方法，允許管理員手動更新員工列表

### 3. 註冊員工無法查看自己收到的需求單問題
- 問題: 新註冊的員工登錄後無法看到分配給他們的需求單
- 原因: 用戶ID處理邏輯不完善，可能在某些情況下無法正確獲取用戶ID
- 解決方案:
  - 增強 `RequirementManager.__init__` 中用戶ID的獲取邏輯，支持多種格式的用戶對象
  - 在 `load_user_requirements` 和 `submit_requirement` 方法中添加用戶ID檢查
  - 在 `RequirementApp.setup_staff_interface` 中添加用戶對象有效性檢查
  - 改進沒有需求單時的提示顯示方式

## 功能特點

1. 用戶管理
   - 支持管理員和普通員工角色
   - 用戶登入/登出功能

2. 需求單管理
   - 管理員可以派發需求單給員工
   - 支持普通和緊急兩種優先級
   - 員工可以查看分配給自己的需求單

3. 預約發派功能
   - 管理員可選擇立即發派或預約發派需求單
   - 可設定發派的日期和時間
   - 系統在預約時間到達時自動發派需求單
   - 管理員可查看和取消預約發派的需求單

## 系統架構

- 前端界面：使用Tkinter開發GUI
- 數據存儲：使用SQLite數據庫
- 後台處理：使用Python多線程技術實現自動發派功能

## 數據庫結構

- users表：存儲用戶信息（ID, 用戶名, 密碼, 姓名, Email, 角色）
- requirements表：存儲需求單信息（ID, 標題, 內容, 指派者ID, 接收者ID, 狀態, 優先級, 創建時間, 預約時間, 是否已發派）

## 使用說明

1. 管理員可以：
   - 創建並立即發派需求單
   - 創建並預約發派需求單
   - 查看已發派的需求單
   - 查看和取消預約發派的需求單

2. 員工可以：
   - 查看分配給自己的需求單
   - 查看需求單詳情 